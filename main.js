/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var se=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var me=Object.prototype.hasOwnProperty;var ge=(c,s)=>{for(var e in s)se(c,e,{get:s[e],enumerable:!0})},he=(c,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of pe(s))!me.call(c,i)&&i!==e&&se(c,i,{get:()=>s[i],enumerable:!(t=de(s,i))||t.enumerable});return c};var ye=c=>he(se({},"__esModule",{value:!0}),c);var De={};ge(De,{default:()=>ee});module.exports=ye(De);var x=require("obsidian");var I={seed:{level:"seed",icon:"\u{1F331}",displayName:"Seed",description:"Initial idea, raw state",minQualityScore:0,order:1},sprout:{level:"sprout",icon:"\u{1F33F}",displayName:"Sprout",description:"Basic structure, some connections",minQualityScore:40,order:2},tree:{level:"tree",icon:"\u{1F333}",displayName:"Tree",description:"Complete atomic note, rich connections",minQualityScore:70,order:3},evergreen:{level:"evergreen",icon:"\u{1F332}",displayName:"Evergreen",description:"Continuously updated, core hub note",minQualityScore:90,order:4}},m=class c{constructor(s){this._config=I[s]}static create(s){if(!I[s])throw new Error(`Invalid maturity level: ${s}`);return new c(s)}static default(){return new c("seed")}static fromQualityScore(s){return s>=I.evergreen.minQualityScore?c.create("evergreen"):s>=I.tree.minQualityScore?c.create("tree"):s>=I.sprout.minQualityScore?c.create("sprout"):c.create("seed")}static fromFrontmatter(s){if(!s)return c.default();let e=s.toLowerCase().trim();return I[e]?c.create(e):c.default()}get level(){return this._config.level}get icon(){return this._config.icon}get displayName(){return this._config.displayName}get description(){return this._config.description}get minQualityScore(){return this._config.minQualityScore}get order(){return this._config.order}getDisplayText(){return`${this._config.icon} ${this._config.displayName}`}getFullDisplayText(){return`${this._config.icon} ${this._config.displayName}: ${this._config.description}`}toFrontmatter(){return this._config.level}equals(s){return this._config.level===s._config.level}isHigherThan(s){return this._config.order>s._config.order}isLowerThan(s){return this._config.order<s._config.order}getNextLevel(){let s=["seed","sprout","tree","evergreen"],e=s.indexOf(this._config.level);return e===s.length-1?null:c.create(s[e+1])}canUpgradeTo(s){return s.isHigherThan(this)}canDowngradeTo(s){return!1}getNextLevelThreshold(){let s=this.getNextLevel();return s?s.minQualityScore:null}static getAllLevels(){return["seed","sprout","tree","evergreen"].map(s=>c.create(s))}};var ie={atomicity:{type:"atomicity",displayName:"Atomicity",description:"Does this note contain only one idea?",weight:.25,icon:"\u269B\uFE0F"},connectivity:{type:"connectivity",displayName:"Connectivity",description:"Are there meaningful connections to other notes?",weight:.25,icon:"\u{1F517}"},clarity:{type:"clarity",displayName:"Clarity",description:"Is it understandable without additional context?",weight:.2,icon:"\u{1F4A1}"},evidence:{type:"evidence",displayName:"Evidence",description:"Are sources, examples, or evidence provided?",weight:.15,icon:"\u{1F4DA}"},originality:{type:"originality",displayName:"Originality",description:"Is it expressed in your own words, not just copied?",weight:.15,icon:"\u2728"}},E=class c{constructor(s,e,t){this._config=ie[s],this._score=this.validateScore(e),this._feedback=t}static create(s,e,t=""){if(!ie[s])throw new Error(`Invalid quality dimension type: ${s}`);return new c(s,e,t)}static fromData(s){return c.create(s.type,s.score,s.feedback)}validateScore(s){return s<0?0:s>100?100:Math.round(s)}get type(){return this._config.type}get displayName(){return this._config.displayName}get description(){return this._config.description}get weight(){return this._config.weight}get icon(){return this._config.icon}get score(){return this._score}get feedback(){return this._feedback}get weightedScore(){return this._score*this._config.weight}getGrade(){return this._score>=90?"A":this._score>=80?"B":this._score>=70?"C":this._score>=60?"D":"F"}getStatus(){return this._score>=80?"excellent":this._score>=60?"good":this._score>=40?"fair":"needs-improvement"}getDisplayText(){return`${this._config.icon} ${this._config.displayName}: ${this._score}pts`}getDetailedDisplayText(){let s=this.getGrade();return`${this._config.icon} ${this._config.displayName} [${s}]: ${this._score}pts
${this._feedback}`}equals(s){return this._config.type===s._config.type&&this._score===s._score}toData(){return{type:this._config.type,score:this._score,feedback:this._feedback}}static getAllTypes(){return["atomicity","connectivity","clarity","evidence","originality"]}static getConfig(s){return ie[s]}};var w=class c{constructor(s,e=new Date){this._dimensions=new Map,s.forEach(t=>this._dimensions.set(t.type,t)),this._totalScore=this.calculateTotalScore(),this._assessedAt=e}static create(s){let e=E.getAllTypes(),t=new Set(s.map(i=>i.type));for(let i of e)if(!t.has(i))throw new Error(`Missing quality dimension: ${i}`);return new c(s)}static fromScores(s){let e=E.getAllTypes().map(t=>{let i=s[t];return E.create(t,i.score,i.feedback||"")});return c.create(e)}static fromData(s){let e=s.dimensions.map(t=>E.fromData(t));return new c(e,new Date(s.assessedAt))}calculateTotalScore(){let s=0;return this._dimensions.forEach(e=>{s+=e.weightedScore}),Math.round(s)}get totalScore(){return this._totalScore}get assessedAt(){return this._assessedAt}getDimension(s){return this._dimensions.get(s)}getAllDimensions(){return Array.from(this._dimensions.values())}getStrongestDimension(){let s=null;return this._dimensions.forEach(e=>{(!s||e.score>s.score)&&(s=e)}),s}getWeakestDimension(){let s=null;return this._dimensions.forEach(e=>{(!s||e.score<s.score)&&(s=e)}),s}getDimensionsNeedingImprovement(){return this.getAllDimensions().filter(s=>s.score<70).sort((s,e)=>s.score-e.score)}getGrade(){return this._totalScore>=90?"A":this._totalScore>=80?"B":this._totalScore>=70?"C":this._totalScore>=60?"D":"F"}getStatusText(){switch(this.getGrade()){case"A":return"Excellent";case"B":return"Good";case"C":return"Fair";case"D":return"Poor";default:return"Needs Improvement"}}getSummaryText(){return`Total ${this._totalScore}pts (${this.getGrade()}) - ${this.getStatusText()}`}getDetailedText(){let s=[`\u{1F4CA} Total Quality Score: ${this._totalScore}pts (${this.getGrade()})`,"","Dimension Scores:"];this.getAllDimensions().sort((t,i)=>i.score-t.score).forEach(t=>{s.push(`  ${t.getDisplayText()}`)});let e=this.getWeakestDimension();return e.score<70&&(s.push(""),s.push(`\u26A0\uFE0F Most needs improvement: ${e.displayName}`)),s.join(`
`)}equals(s){return this._totalScore===s._totalScore}isHigherThan(s){return this._totalScore>s._totalScore}toData(){return{totalScore:this._totalScore,dimensions:this.getAllDimensions().map(s=>s.toData()),assessedAt:this._assessedAt.getTime()}}};var k=class c{constructor(s,e,t,i,r,n,o,a,l,d,u){this._id=s,this._noteId=e,this._notePath=t,this._qualityScore=i,this._currentMaturity=r,this._recommendedMaturity=n,this._improvements=o,this._splitSuggestion=a,this._connectionSuggestions=l,this._growthGuide=d,this._assessedAt=u}static create(s){let e=m.fromQualityScore(s.qualityScore.totalScore);return new c(c.generateId(),s.noteId,s.notePath,s.qualityScore,s.currentMaturity,e,s.improvements||[],s.splitSuggestion||null,s.connectionSuggestions||[],s.growthGuide||null,new Date)}static fromData(s){return new c(s.id,s.noteId,s.notePath,w.fromData(s.qualityScore),m.create(s.currentMaturity),m.create(s.recommendedMaturity),s.improvements,s.splitSuggestion,s.connectionSuggestions,s.growthGuide,new Date(s.assessedAt))}static generateId(){return`assessment_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}get id(){return this._id}get noteId(){return this._noteId}get notePath(){return this._notePath}get qualityScore(){return this._qualityScore}get currentMaturity(){return this._currentMaturity}get recommendedMaturity(){return this._recommendedMaturity}get improvements(){return this._improvements}get splitSuggestion(){return this._splitSuggestion}get connectionSuggestions(){return this._connectionSuggestions}get growthGuide(){return this._growthGuide}get assessedAt(){return this._assessedAt}isMaturityUpgradeRecommended(){return this._recommendedMaturity.isHigherThan(this._currentMaturity)}hasSplitSuggestion(){return this._splitSuggestion!==null}hasConnectionSuggestions(){return this._connectionSuggestions.length>0}getImprovementsByPriority(s){return this._improvements.filter(e=>e.priority===s)}getHighPriorityImprovements(){return this.getImprovementsByPriority("high")}getSummaryText(){let s=["\u{1F4CA} \uB178\uD2B8 \uD488\uC9C8 \uD3C9\uAC00 \uACB0\uACFC","",`\uD604\uC7AC \uC131\uC219\uB3C4: ${this._currentMaturity.getDisplayText()}`,`\uD488\uC9C8 \uC810\uC218: ${this._qualityScore.getSummaryText()}`];return this.isMaturityUpgradeRecommended()&&s.push(`\u2728 \uCD94\uCC9C \uC131\uC219\uB3C4: ${this._recommendedMaturity.getDisplayText()}`),this.hasSplitSuggestion()&&s.push("\u26A0\uFE0F \uC6D0\uC790\uC131 \uC704\uBC18: \uB178\uD2B8 \uBD84\uB9AC \uCD94\uCC9C"),this.hasConnectionSuggestions()&&s.push(`\u{1F517} \uC5F0\uACB0 \uC81C\uC548: ${this._connectionSuggestions.length}\uAC1C \uB178\uD2B8`),s.join(`
`)}toMarkdown(){let s=["## \u{1F4CA} \uB178\uD2B8 \uD488\uC9C8 \uD3C9\uAC00 \uACB0\uACFC","",`**\uD3C9\uAC00 \uC2DC\uAC04**: ${this._assessedAt.toLocaleString("ko-KR")}`,"","---","","### \u{1F331} \uC131\uC219\uB3C4","","| \uAD6C\uBD84 | \uC0C1\uD0DC |","|------|------|",`| \uD604\uC7AC \uC131\uC219\uB3C4 | ${this._currentMaturity.getDisplayText()} |`,`| \uCD94\uCC9C \uC131\uC219\uB3C4 | ${this._recommendedMaturity.getDisplayText()} |`,""];if(s.push("### \u{1F4C8} \uD488\uC9C8 \uC810\uC218"),s.push(""),s.push(`**\uC885\uD569 \uC810\uC218**: ${this._qualityScore.totalScore}\uC810 (${this._qualityScore.getGrade()})`),s.push(""),s.push("| \uCC28\uC6D0 | \uC810\uC218 | \uD53C\uB4DC\uBC31 |"),s.push("|------|------|--------|"),this._qualityScore.getAllDimensions().forEach(e=>{s.push(`| ${e.icon} ${e.displayName} | ${e.score}\uC810 | ${e.feedback||"-"} |`)}),s.push(""),this._improvements.length>0){s.push("### \u{1F4A1} \uAC1C\uC120 \uC81C\uC548"),s.push("");let e=this.getHighPriorityImprovements();e.length>0&&(s.push("#### \u{1F534} \uB192\uC740 \uC6B0\uC120\uC21C\uC704"),e.forEach(r=>{s.push(`- **${r.dimension}**: ${r.suggestion}`),r.example&&s.push(`  - \uC608\uC2DC: ${r.example}`)}),s.push(""));let t=this.getImprovementsByPriority("medium");t.length>0&&(s.push("#### \u{1F7E1} \uC911\uAC04 \uC6B0\uC120\uC21C\uC704"),t.forEach(r=>{s.push(`- **${r.dimension}**: ${r.suggestion}`)}),s.push(""));let i=this.getImprovementsByPriority("low");i.length>0&&(s.push("#### \u{1F7E2} \uB0AE\uC740 \uC6B0\uC120\uC21C\uC704"),i.forEach(r=>{s.push(`- **${r.dimension}**: ${r.suggestion}`)}),s.push(""))}return this._splitSuggestion&&(s.push("### \u269B\uFE0F \uBD84\uB9AC \uC81C\uC548"),s.push(""),s.push(`**\uC774\uC720**: ${this._splitSuggestion.reason}`),s.push(""),s.push("**\uC81C\uC548\uB418\uB294 \uC0C8 \uB178\uD2B8**:"),this._splitSuggestion.suggestedNotes.forEach((e,t)=>{s.push(`${t+1}. **${e.title}**`),s.push(`   - ${e.description}`),s.push(`   - \uD575\uC2EC \uC544\uC774\uB514\uC5B4: ${e.coreIdea}`)}),s.push("")),this._connectionSuggestions.length>0&&(s.push("### \u{1F517} \uC5F0\uACB0 \uC81C\uC548"),s.push(""),this._connectionSuggestions.forEach(e=>{let t=this.getConnectionTypeIcon(e.relationshipType);s.push(`- ${t} **[[${e.targetNote}]]**`),s.push(`  - \uAD00\uACC4: ${e.relationshipType}`),s.push(`  - \uC774\uC720: ${e.reason}`)}),s.push("")),this._growthGuide&&(s.push("### \u{1F680} \uC131\uC7A5 \uAC00\uC774\uB4DC"),s.push(""),s.push(`**\uBAA9\uD45C**: ${m.create(this._growthGuide.currentLevel).getDisplayText()} \u2192 ${m.create(this._growthGuide.targetLevel).getDisplayText()}`),s.push(`**\uD544\uC694 \uC810\uC218**: ${this._growthGuide.currentScore}\uC810 \u2192 ${this._growthGuide.requiredScore}\uC810`),s.push(`**\uC608\uC0C1 \uB178\uB825**: ${this.getEffortText(this._growthGuide.estimatedEffort)}`),s.push(""),s.push("**\uB2E8\uACC4\uBCC4 \uC561\uC158**:"),this._growthGuide.steps.forEach(e=>{s.push(`${e.step}. ${e.action}`),s.push(`   - \uAE30\uB300 \uD6A8\uACFC: ${e.expectedImpact}`)}),s.push("")),s.join(`
`)}getConnectionTypeIcon(s){return{supports:"\u{1F91D}",contradicts:"\u2694\uFE0F",extends:"\u{1F4D0}",exemplifies:"\u{1F4D6}",relates:"\u{1F517}"}[s]||"\u{1F517}"}getEffortText(s){return{low:"\uB0AE\uC74C (10-30\uBD84)",medium:"\uBCF4\uD1B5 (30\uBD84-1\uC2DC\uAC04)",high:"\uB192\uC74C (1\uC2DC\uAC04 \uC774\uC0C1)"}[s]||s}toData(){return{id:this._id,noteId:this._noteId,notePath:this._notePath,qualityScore:this._qualityScore.toData(),currentMaturity:this._currentMaturity.level,recommendedMaturity:this._recommendedMaturity.level,improvements:[...this._improvements],splitSuggestion:this._splitSuggestion,connectionSuggestions:[...this._connectionSuggestions],growthGuide:this._growthGuide,assessedAt:this._assessedAt.getTime()}}};var S={claude:{id:"claude",name:"Anthropic Claude",displayName:"Claude",endpoint:"https://api.anthropic.com/v1",defaultModel:"claude-sonnet-4-5-20250929"},gemini:{id:"gemini",name:"Google Gemini",displayName:"Gemini",endpoint:"https://generativelanguage.googleapis.com/v1beta",apiKeyPrefix:"AIza",defaultModel:"gemini-3-flash-preview"},openai:{id:"openai",name:"OpenAI",displayName:"OpenAI",endpoint:"https://api.openai.com/v1",apiKeyPrefix:"sk-",defaultModel:"gpt-5.2"},grok:{id:"grok",name:"xAI Grok",displayName:"Grok",endpoint:"https://api.x.ai/v1",defaultModel:"grok-4-1-fast"}},re={"claude-sonnet-4-5-20250929":{id:"claude-sonnet-4-5-20250929",displayName:"Claude Sonnet 4.5",provider:"claude",maxTokens:16384},"claude-3-5-haiku-20241022":{id:"claude-3-5-haiku-20241022",displayName:"Claude 3.5 Haiku",provider:"claude",maxTokens:8192},"gemini-3-flash-preview":{id:"gemini-3-flash-preview",displayName:"Gemini 3 Flash",provider:"gemini",maxTokens:65536},"gemini-2.0-flash":{id:"gemini-2.0-flash",displayName:"Gemini 2.0 Flash",provider:"gemini",maxTokens:8192},"gpt-5.2":{id:"gpt-5.2",displayName:"GPT-5.2",provider:"openai",maxTokens:32768},"gpt-4o-mini":{id:"gpt-4o-mini",displayName:"GPT-4o Mini",provider:"openai",maxTokens:16384},"grok-4-1-fast":{id:"grok-4-1-fast",displayName:"Grok 4.1 Fast",provider:"grok",maxTokens:16384}};function H(c){return Object.values(re).filter(s=>s.provider===c)}var fe=`\uB2F9\uC2E0\uC740 Zettelkasten \uC6D0\uCE59\uC5D0 \uAE30\uBC18\uD55C \uC601\uAD6C \uB178\uD2B8 \uD488\uC9C8 \uD3C9\uAC00 \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4.

**\uD3C9\uAC00 \uAE30\uC900 (\uAC01 0-100\uC810):**

1. **\uC6D0\uC790\uC131 (Atomicity)** - 25% \uAC00\uC911\uCE58
   - \uD558\uB098\uC758 \uB178\uD2B8\uB294 \uD558\uB098\uC758 \uD575\uC2EC \uC544\uC774\uB514\uC5B4\uB9CC \uB2F4\uC544\uC57C \uD568
   - 100\uC810: \uB2E8\uC77C \uC544\uC774\uB514\uC5B4\uC5D0 \uC9D1\uC911, \uC27D\uAC8C \uBD84\uB9AC \uBD88\uAC00
   - 70\uC810: \uC8FC\uC694 \uC544\uC774\uB514\uC5B4\uAC00 \uBA85\uD655\uD558\uB098 \uBD80\uC218\uC801 \uB0B4\uC6A9 \uC77C\uBD80 \uC874\uC7AC
   - 40\uC810: 2-3\uAC1C \uC544\uC774\uB514\uC5B4\uAC00 \uD63C\uC7AC
   - 0\uC810: \uC5EC\uB7EC \uC8FC\uC81C\uAC00 \uD63C\uD569\uB418\uC5B4 \uBD84\uB9AC \uD544\uC694

2. **\uC5F0\uACB0\uC131 (Connectivity)** - 25% \uAC00\uC911\uCE58
   - \uB2E4\uB978 \uB178\uD2B8\uC640\uC758 \uC758\uBBF8 \uC788\uB294 \uC5F0\uACB0
   - 100\uC810: 5\uAC1C \uC774\uC0C1\uC758 \uAD00\uB828 \uB178\uD2B8\uC640 \uC591\uBC29\uD5A5 \uC5F0\uACB0
   - 70\uC810: 3-4\uAC1C \uB178\uD2B8\uC640 \uC5F0\uACB0, \uC5F0\uACB0 \uC774\uC720 \uBA85\uD655
   - 40\uC810: 1-2\uAC1C \uC5F0\uACB0\uB9CC \uC874\uC7AC
   - 0\uC810: \uACE0\uB9BD\uB41C \uB178\uD2B8

3. **\uBA85\uD655\uC131 (Clarity)** - 20% \uAC00\uC911\uCE58
   - \uB9E5\uB77D \uC5C6\uC774\uB3C4 \uB3C5\uB9BD\uC801\uC73C\uB85C \uC774\uD574 \uAC00\uB2A5
   - 100\uC810: \uC644\uC804\uD55C \uB3C5\uB9BD \uC774\uD574 \uAC00\uB2A5, \uBA85\uD655\uD55C \uAD6C\uC870
   - 70\uC810: \uB300\uBD80\uBD84 \uC774\uD574 \uAC00\uB2A5, \uC57D\uAC04\uC758 \uBC30\uACBD\uC9C0\uC2DD \uD544\uC694
   - 40\uC810: \uC0C1\uB2F9\uD55C \uB9E5\uB77D \uC9C0\uC2DD \uD544\uC694
   - 0\uC810: \uB3C5\uB9BD\uC801 \uC774\uD574 \uBD88\uAC00

4. **\uADFC\uAC70 (Evidence)** - 15% \uAC00\uC911\uCE58
   - \uCD9C\uCC98, \uC608\uC2DC, \uADFC\uAC70\uC758 \uCDA9\uBD84\uC131
   - 100\uC810: \uBA85\uD655\uD55C \uCD9C\uCC98\uC640 \uAD6C\uCCB4\uC801 \uC608\uC2DC \uD3EC\uD568
   - 70\uC810: \uC77C\uBD80 \uCD9C\uCC98 \uB610\uB294 \uC608\uC2DC \uD3EC\uD568
   - 40\uC810: \uCD9C\uCC98 \uC5C6\uC774 \uC8FC\uC7A5\uB9CC \uC874\uC7AC
   - 0\uC810: \uADFC\uAC70 \uC644\uC804 \uBD80\uC7AC

5. **\uB3C5\uCC3D\uC131 (Originality)** - 15% \uAC00\uC911\uCE58
   - \uB2E8\uC21C \uBCF5\uC0AC\uAC00 \uC544\uB2CC \uC790\uAE30 \uC5B8\uC5B4\uB85C \uD45C\uD604
   - 100\uC810: \uC644\uC804\uD788 \uC790\uAE30 \uC5B8\uC5B4, \uACE0\uC720\uD55C \uD1B5\uCC30 \uD3EC\uD568
   - 70\uC810: \uB300\uBD80\uBD84 \uC790\uAE30 \uD45C\uD604, \uC77C\uBD80 \uC778\uC6A9
   - 40\uC810: \uC778\uC6A9 \uC704\uC8FC, \uC790\uAE30 \uD574\uC11D \uBD80\uC871
   - 0\uC810: \uBCF5\uC0AC/\uBD99\uC5EC\uB123\uAE30

**\uBD84\uB9AC \uC81C\uC548 \uAE30\uC900:**
\uC6D0\uC790\uC131 \uC810\uC218\uAC00 50\uC810 \uBBF8\uB9CC\uC774\uBA74 \uBD84\uB9AC\uB97C \uC81C\uC548\uD569\uB2C8\uB2E4.

\uBAA8\uB4E0 \uC751\uB2F5\uC740 \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD569\uB2C8\uB2E4.`;function Se(c){var i;let{note:s,existingLinks:e,backlinks:t}=c;return`\uB2E4\uC74C \uB178\uD2B8\uB97C Zettelkasten \uC6D0\uCE59\uC5D0 \uB530\uB77C \uD3C9\uAC00\uD574\uC8FC\uC138\uC694.

**\uB178\uD2B8 \uC81C\uBAA9**: ${s.basename}
**\uD0DC\uADF8**: ${((i=s.metadata.tags)==null?void 0:i.join(", "))||"\uC5C6\uC74C"}
**\uC544\uC6C3\uB9C1\uD06C**: ${e.length}\uAC1C (${e.slice(0,5).join(", ")}${e.length>5?"...":""})
**\uBC31\uB9C1\uD06C**: ${t.length}\uAC1C (${t.slice(0,5).join(", ")}${t.length>5?"...":""})

**\uB178\uD2B8 \uB0B4\uC6A9**:
---
${s.content}
---

**\uC751\uB2F5 \uD615\uC2DD:**
\uB2E4\uC74C JSON \uD615\uC2DD\uC73C\uB85C \uC751\uB2F5\uD558\uC138\uC694:
\`\`\`json
{
  "dimensions": {
    "atomicity": {
      "score": 0-100,
      "feedback": "\uD604\uC7AC \uC0C1\uD0DC \uD3C9\uAC00 \uBC0F \uAD6C\uCCB4\uC801\uC778 \uAC1C\uC120 \uBC29\uD5A5 (2-3\uBB38\uC7A5)"
    },
    "connectivity": {
      "score": 0-100,
      "feedback": "\uD604\uC7AC \uC0C1\uD0DC \uD3C9\uAC00 \uBC0F \uAD6C\uCCB4\uC801\uC778 \uAC1C\uC120 \uBC29\uD5A5 (2-3\uBB38\uC7A5)"
    },
    "clarity": {
      "score": 0-100,
      "feedback": "\uD604\uC7AC \uC0C1\uD0DC \uD3C9\uAC00 \uBC0F \uAD6C\uCCB4\uC801\uC778 \uAC1C\uC120 \uBC29\uD5A5 (2-3\uBB38\uC7A5)"
    },
    "evidence": {
      "score": 0-100,
      "feedback": "\uD604\uC7AC \uC0C1\uD0DC \uD3C9\uAC00 \uBC0F \uAD6C\uCCB4\uC801\uC778 \uAC1C\uC120 \uBC29\uD5A5 (2-3\uBB38\uC7A5)"
    },
    "originality": {
      "score": 0-100,
      "feedback": "\uD604\uC7AC \uC0C1\uD0DC \uD3C9\uAC00 \uBC0F \uAD6C\uCCB4\uC801\uC778 \uAC1C\uC120 \uBC29\uD5A5 (2-3\uBB38\uC7A5)"
    }
  },
  "splitSuggestion": {
    "reason": "\uBD84\uB9AC\uAC00 \uD544\uC694\uD55C \uC774\uC720 (\uC6D0\uC790\uC131 \uC810\uC218 50 \uBBF8\uB9CC\uC778 \uACBD\uC6B0\uC5D0\uB9CC)",
    "suggestedNotes": [
      {
        "title": "\uC0C8 \uB178\uD2B8 \uC81C\uBAA9",
        "description": "\uC0C8 \uB178\uD2B8 \uC124\uBA85",
        "coreIdea": "\uD575\uC2EC \uC544\uC774\uB514\uC5B4"
      }
    ]
  }
}
\`\`\`

**\uC8FC\uC758\uC0AC\uD56D:**
- \uAC01 \uCC28\uC6D0\uC758 \uC810\uC218\uB294 \uAC1D\uAD00\uC801 \uAE30\uC900\uC5D0 \uB530\uB77C \uBD80\uC5EC
- feedback\uC740 \uD604\uC7AC \uC0C1\uD0DC \uD3C9\uAC00\uC640 \uD568\uAED8 **\uAD6C\uCCB4\uC801\uC778 \uAC1C\uC120 \uBC29\uD5A5**\uC744 \uD3EC\uD568
- splitSuggestion\uC740 \uC6D0\uC790\uC131 \uC810\uC218\uAC00 50 \uBBF8\uB9CC\uC778 \uACBD\uC6B0\uC5D0\uB9CC \uD3EC\uD568`}function Le(c){try{let s=c.match(/```(?:json)?\s*([\s\S]*?)```/),e=s?s[1].trim():c.trim();return JSON.parse(e)}catch(s){return console.error("Failed to parse assessment response:",s),null}}var T=class{constructor(s){this.llmProvider=s}async execute(s){var u;let{note:e}=s;if(!e.content||e.content.trim().length<50)return{assessment:null,error:"\uB178\uD2B8 \uB0B4\uC6A9\uC774 \uB108\uBB34 \uC9E7\uC2B5\uB2C8\uB2E4. \uCD5C\uC18C 50\uC790 \uC774\uC0C1\uC774\uC5B4\uC57C \uD3C9\uAC00\uAC00 \uAC00\uB2A5\uD569\uB2C8\uB2E4."};let t=Se(s),i=await this.llmProvider.simpleGenerate(t,fe,{maxTokens:3e3,temperature:.5});if(!i.success)return{assessment:null,error:(u=i.error)!=null?u:"LLM \uC694\uCCAD\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",rawResponse:i.content};let r=Le(i.content);if(!r)return{assessment:null,error:"\uD3C9\uAC00 \uACB0\uACFC \uD30C\uC2F1\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",rawResponse:i.content};let n=w.fromScores({atomicity:{score:r.dimensions.atomicity.score,feedback:r.dimensions.atomicity.feedback},connectivity:{score:r.dimensions.connectivity.score,feedback:r.dimensions.connectivity.feedback},clarity:{score:r.dimensions.clarity.score,feedback:r.dimensions.clarity.feedback},evidence:{score:r.dimensions.evidence.score,feedback:r.dimensions.evidence.feedback},originality:{score:r.dimensions.originality.score,feedback:r.dimensions.originality.feedback}}),o=m.fromFrontmatter(e.metadata.growthStage),l=[{key:"atomicity",name:"\uC6D0\uC790\uC131"},{key:"connectivity",name:"\uC5F0\uACB0\uC131"},{key:"clarity",name:"\uBA85\uD655\uC131"},{key:"evidence",name:"\uADFC\uAC70"},{key:"originality",name:"\uB3C5\uCC3D\uC131"}].map(({key:p,name:h})=>{let g=r.dimensions[p],y=g.score>=80?"low":g.score>=60?"medium":"high";return{dimension:h,priority:y,suggestion:g.feedback}});return{assessment:k.create({noteId:e.id,notePath:e.path,qualityScore:n,currentMaturity:o,improvements:l,splitSuggestion:r.splitSuggestion||null}),rawResponse:i.content}}};var Me=`\uB2F9\uC2E0\uC740 Zettelkasten \uAE30\uBC18 \uC9C0\uC2DD \uB124\uD2B8\uC6CC\uD06C \uAD6C\uCD95 \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4.

**\uC5F0\uACB0 \uC720\uD615:**
1. **supports (\uC9C0\uC9C0)**: \uD604\uC7AC \uB178\uD2B8\uC758 \uC8FC\uC7A5\uC744 \uB4B7\uBC1B\uCE68\uD558\uAC70\uB098 \uC99D\uAC70\uB97C \uC81C\uACF5
2. **contradicts (\uBC18\uBC15)**: \uD604\uC7AC \uB178\uD2B8\uC640 \uC0C1\uBC18\uB418\uB294 \uAD00\uC810\uC774\uB098 \uBC18\uB840 \uC81C\uC2DC
3. **extends (\uD655\uC7A5)**: \uD604\uC7AC \uB178\uD2B8\uC758 \uC544\uC774\uB514\uC5B4\uB97C \uB354 \uAE4A\uC774 \uBC1C\uC804\uC2DC\uD0B4
4. **exemplifies (\uC608\uC2DC)**: \uD604\uC7AC \uB178\uD2B8 \uAC1C\uB150\uC758 \uAD6C\uCCB4\uC801 \uC0AC\uB840\uB098 \uC801\uC6A9
5. **relates (\uAD00\uB828)**: \uC8FC\uC81C\uC801\uC73C\uB85C \uAD00\uB828\uB418\uC5B4 \uC788\uC73C\uB098 \uC704 \uC720\uD615\uC5D0 \uD574\uB2F9\uD558\uC9C0 \uC54A\uC74C

**\uC88B\uC740 \uC5F0\uACB0\uC758 \uD2B9\uC131:**
- \uC758\uBBF8 \uC788\uB294 \uAD00\uACC4: \uB2E8\uC21C \uD0A4\uC6CC\uB4DC \uC77C\uCE58\uAC00 \uC544\uB2CC \uAC1C\uB150\uC801 \uC5F0\uACB0
- \uC591\uBC29\uD5A5 \uAC00\uCE58: \uB450 \uB178\uD2B8 \uBAA8\uB450\uC5D0 \uC778\uC0AC\uC774\uD2B8 \uC81C\uACF5
- \uBC1C\uACAC \uAC00\uB2A5\uC131: \uC0C8\uB85C\uC6B4 \uAD00\uC810\uC774\uB098 \uC544\uC774\uB514\uC5B4 \uCD09\uBC1C

\uBAA8\uB4E0 \uC751\uB2F5\uC740 \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD569\uB2C8\uB2E4.`;function we(c){var r;let{note:s,candidateNotes:e,maxSuggestions:t=5}=c,i=e.slice(0,20).map((n,o)=>`${o+1}. "${n.basename}" - \uD0DC\uADF8: ${n.tags.slice(0,3).join(", ")}`).join(`
`);return`\uB2E4\uC74C \uB178\uD2B8\uC640 \uC5F0\uACB0\uD560 \uC218 \uC788\uB294 \uB178\uD2B8\uB4E4\uC744 \uC81C\uC548\uD574\uC8FC\uC138\uC694.

**\uD604\uC7AC \uB178\uD2B8 \uC81C\uBAA9**: ${s.basename}
**\uD0DC\uADF8**: ${((r=s.metadata.tags)==null?void 0:r.join(", "))||"\uC5C6\uC74C"}

**\uB178\uD2B8 \uB0B4\uC6A9**:
---
${s.content.slice(0,2e3)}${s.content.length>2e3?"...":""}
---

**\uC5F0\uACB0 \uD6C4\uBCF4 \uB178\uD2B8\uB4E4**:
${i}

**\uC751\uB2F5 \uD615\uC2DD:**
\uAC00\uC7A5 \uC758\uBBF8 \uC788\uB294 \uC5F0\uACB0\uC744 ${t}\uAC1C\uAE4C\uC9C0 \uC81C\uC548\uD558\uC138\uC694.
\`\`\`json
{
  "connections": [
    {
      "targetNote": "\uB178\uD2B8 \uC81C\uBAA9 (\uC815\uD655\uD788 \uC77C\uCE58)",
      "relationshipType": "supports|contradicts|extends|exemplifies|relates",
      "reason": "\uC5F0\uACB0 \uC774\uC720 (1-2\uBB38\uC7A5, \uAD6C\uCCB4\uC801\uC73C\uB85C)",
      "linkSuggestion": "\uB178\uD2B8\uC5D0 \uCD94\uAC00\uD560 \uB9C1\uD06C \uBB38\uC7A5 \uC608\uC2DC"
    }
  ]
}
\`\`\`

**\uC8FC\uC758\uC0AC\uD56D:**
- targetNote\uB294 \uD6C4\uBCF4 \uBAA9\uB85D\uC5D0 \uC788\uB294 \uC815\uD655\uD55C \uC774\uB984 \uC0AC\uC6A9
- \uC5F0\uACB0 \uC774\uC720\uB294 \uAD6C\uCCB4\uC801\uC774\uACE0 \uC758\uBBF8 \uC788\uAC8C \uC791\uC131
- \uB2E8\uC21C \uD0A4\uC6CC\uB4DC \uC77C\uCE58\uAC00 \uC544\uB2CC \uAC1C\uB150\uC801 \uC5F0\uACB0 \uC6B0\uC120
- linkSuggestion\uC740 \uC2E4\uC81C\uB85C \uB178\uD2B8\uC5D0 \uCD94\uAC00\uD560 \uC218 \uC788\uB294 \uBB38\uC7A5 \uD615\uD0DC`}function xe(c){try{let s=c.match(/```(?:json)?\s*([\s\S]*?)```/),e=s?s[1].trim():c.trim();return JSON.parse(e)}catch(s){return console.error("Failed to parse connection response:",s),null}}var N=class{constructor(s){this.llmProvider=s}async execute(s){var a;let{note:e,candidateNotes:t}=s;if(t.length===0)return{suggestions:[],error:"\uC5F0\uACB0 \uD6C4\uBCF4 \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."};if(!e.content||e.content.trim().length<30)return{suggestions:[],error:"\uB178\uD2B8 \uB0B4\uC6A9\uC774 \uB108\uBB34 \uC9E7\uC544 \uC5F0\uACB0 \uC81C\uC548\uC774 \uC5B4\uB835\uC2B5\uB2C8\uB2E4."};let i=we(s),r=await this.llmProvider.simpleGenerate(i,Me,{maxTokens:2e3,temperature:.7});if(!r.success)return{suggestions:[],error:(a=r.error)!=null?a:"LLM \uC694\uCCAD\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",rawResponse:r.content};let n=xe(r.content);return n?{suggestions:n.connections.filter(l=>t.some(d=>d.basename.toLowerCase()===l.targetNote.toLowerCase())).map(l=>({targetNote:l.targetNote,relationshipType:l.relationshipType,reason:l.reason,linkSuggestion:l.linkSuggestion})),rawResponse:r.content}:{suggestions:[],error:"\uC5F0\uACB0 \uC81C\uC548 \uD30C\uC2F1\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",rawResponse:r.content}}};var C=class{constructor(s){this.noteRepository=s}async execute(s){let{noteId:e,currentMaturity:t,targetMaturity:i,qualityScore:r,forceUpdate:n}=s,o;if(i)o=i;else if(r)o=m.fromQualityScore(r.totalScore);else return{success:!1,previousLevel:t,newLevel:t,isUpgrade:!1,error:"\uB300\uC0C1 \uC131\uC219\uB3C4 \uB610\uB294 \uD488\uC9C8 \uC810\uC218\uAC00 \uD544\uC694\uD569\uB2C8\uB2E4."};let a=o.isHigherThan(t),l=o.isLowerThan(t);if(o.equals(t))return{success:!0,previousLevel:t,newLevel:t,isUpgrade:!1};if(l&&!n)return{success:!1,previousLevel:t,newLevel:t,isUpgrade:!1,error:`\uC131\uC219\uB3C4\uB97C \uB0AE\uCD9C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4: ${t.getDisplayText()} \u2192 ${o.getDisplayText()}`};if(a&&r){let u=o.minQualityScore;if(r.totalScore<u&&!n)return{success:!1,previousLevel:t,newLevel:t,isUpgrade:!1,error:`${o.getDisplayText()}\uB85C \uC5C5\uADF8\uB808\uC774\uB4DC\uD558\uB824\uBA74 \uD488\uC9C8 \uC810\uC218\uAC00 ${u}\uC810 \uC774\uC0C1\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4. (\uD604\uC7AC: ${r.totalScore}\uC810)`}}try{return await this.noteRepository.updateMaturityLevel(e,o),{success:!0,previousLevel:t,newLevel:o,isUpgrade:a}}catch(u){return{success:!1,previousLevel:t,newLevel:t,isUpgrade:!1,error:`\uC131\uC219\uB3C4 \uC5C5\uB370\uC774\uD2B8 \uC2E4\uD328: ${u instanceof Error?u.message:String(u)}`}}}static isUpgradeRecommended(s,e){let t=m.fromQualityScore(e.totalScore);return t.isHigherThan(s)?{recommended:!0,targetLevel:t,reason:`\uD488\uC9C8 \uC810\uC218 ${e.totalScore}\uC810\uC73C\uB85C ${t.getDisplayText()} \uB808\uBCA8 \uAE30\uC900(${t.minQualityScore}\uC810)\uC744 \uCDA9\uC871\uD569\uB2C8\uB2E4.`}:{recommended:!1,targetLevel:null,reason:"\uD604\uC7AC \uD488\uC9C8 \uC810\uC218\uAC00 \uB354 \uB192\uC740 \uC131\uC219\uB3C4 \uAE30\uC900\uC744 \uCDA9\uC871\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4."}}};var be=`\uB2F9\uC2E0\uC740 Zettelkasten \uAE30\uBC18 \uC601\uAD6C \uB178\uD2B8 \uC791\uC131 \uCF54\uCE58\uC785\uB2C8\uB2E4.

**\uC131\uC219\uB3C4 \uB2E8\uACC4:**
- \u{1F331} Seed (0-39\uC810): \uCD08\uAE30 \uC544\uC774\uB514\uC5B4, \uBBF8\uAC00\uACF5 \uC0C1\uD0DC
- \u{1F33F} Sprout (40-69\uC810): \uAE30\uBCF8 \uAD6C\uC870\uD654, \uC77C\uBD80 \uC5F0\uACB0
- \u{1F333} Tree (70-89\uC810): \uC644\uC131\uB41C \uC6D0\uC790\uC801 \uB178\uD2B8, \uD48D\uBD80\uD55C \uC5F0\uACB0
- \u{1F332} Evergreen (90-100\uC810): \uC9C0\uC18D \uC5C5\uB370\uC774\uD2B8, \uD575\uC2EC \uD5C8\uBE0C \uB178\uD2B8

**\uC131\uC7A5 \uAC00\uC774\uB4DC \uC6D0\uCE59:**
1. \uAC00\uC7A5 \uD070 \uC601\uD5A5\uC744 \uC8FC\uB294 \uAC1C\uC120\uBD80\uD130 \uC81C\uC548
2. \uAD6C\uCCB4\uC801\uC774\uACE0 \uC2E4\uD589 \uAC00\uB2A5\uD55C \uC561\uC158
3. \uD604\uC2E4\uC801\uC778 \uC608\uC0C1 \uD6A8\uACFC
4. \uB2E8\uACC4\uBCC4 \uC6B0\uC120\uC21C\uC704

\uBAA8\uB4E0 \uC751\uB2F5\uC740 \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD569\uB2C8\uB2E4.`;function Ee(c){let{note:s,currentMaturity:e,qualityScore:t}=c,i=e.getNextLevel();if(!i)return"";let r=t.getDimensionsNeedingImprovement().map(n=>`- ${n.displayName}: ${n.score}\uC810 (${n.feedback})`).join(`
`);return`\uB2E4\uC74C \uB178\uD2B8\uAC00 ${e.getDisplayText()}\uC5D0\uC11C ${i.getDisplayText()}\uB85C \uC131\uC7A5\uD558\uAE30 \uC704\uD55C \uAC00\uC774\uB4DC\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

**\uB178\uD2B8 \uC81C\uBAA9**: ${s.basename}
**\uD604\uC7AC \uC131\uC219\uB3C4**: ${e.getDisplayText()}
**\uBAA9\uD45C \uC131\uC219\uB3C4**: ${i.getDisplayText()}
**\uD604\uC7AC \uD488\uC9C8 \uC810\uC218**: ${t.totalScore}\uC810
**\uD544\uC694 \uC810\uC218**: ${i.minQualityScore}\uC810 \uC774\uC0C1

**\uAC1C\uC120\uC774 \uD544\uC694\uD55C \uCC28\uC6D0:**
${r||"\uC5C6\uC74C"}

**\uB178\uD2B8 \uB0B4\uC6A9 (\uC77C\uBD80)**:
---
${s.content.slice(0,1500)}${s.content.length>1500?"...":""}
---

**\uC751\uB2F5 \uD615\uC2DD:**
\`\`\`json
{
  "steps": [
    {
      "step": 1,
      "action": "\uAD6C\uCCB4\uC801\uC778 \uC561\uC158 (1\uBB38\uC7A5)",
      "expectedImpact": "\uC608\uC0C1 \uD6A8\uACFC (\uC5B4\uB5A4 \uCC28\uC6D0\uC774 \uC5B4\uB290 \uC815\uB3C4 \uD5A5\uC0C1\uB420\uC9C0)"
    }
  ],
  "estimatedEffort": "low|medium|high"
}
\`\`\`

**\uC8FC\uC758\uC0AC\uD56D:**
- steps\uB294 3-5\uAC1C, \uC6B0\uC120\uC21C\uC704 \uC21C
- \uAC01 action\uC740 \uC989\uC2DC \uC2E4\uD589 \uAC00\uB2A5\uD55C \uAD6C\uCCB4\uC801 \uD589\uB3D9
- \uD604\uC7AC \uB178\uD2B8 \uB0B4\uC6A9\uC744 \uCC38\uACE0\uD558\uC5EC \uB9DE\uCDA4 \uC81C\uC548
- estimatedEffort\uB294 \uCD1D \uC608\uC0C1 \uC791\uC5C5\uB7C9`}function ke(c){try{let s=c.match(/```(?:json)?\s*([\s\S]*?)```/),e=s?s[1].trim():c.trim();return JSON.parse(e)}catch(s){return console.error("Failed to parse growth guide response:",s),null}}var _=class{constructor(s){this.llmProvider=s}async execute(s){var l;let{currentMaturity:e,qualityScore:t}=s,i=e.getNextLevel();if(!i)return{guide:null,error:"\uC774\uBBF8 \uCD5C\uACE0 \uC131\uC219\uB3C4(\u{1F332} Evergreen)\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4."};if(t.totalScore>=i.minQualityScore)return{guide:{currentLevel:e.level,targetLevel:i.level,requiredScore:i.minQualityScore,currentScore:t.totalScore,steps:[{step:1,action:"\uC131\uC219\uB3C4 \uB808\uBCA8\uC744 \uC5C5\uB370\uC774\uD2B8\uD558\uC138\uC694.",expectedImpact:`${e.getDisplayText()} \u2192 ${i.getDisplayText()} \uC804\uD658`}],estimatedEffort:"low"}};let r=Ee(s),n=await this.llmProvider.simpleGenerate(r,be,{maxTokens:2e3,temperature:.7});if(!n.success)return{guide:null,error:(l=n.error)!=null?l:"LLM \uC694\uCCAD\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",rawResponse:n.content};let o=ke(n.content);return o?{guide:{currentLevel:e.level,targetLevel:i.level,requiredScore:i.minQualityScore,currentScore:t.totalScore,steps:o.steps,estimatedEffort:o.estimatedEffort},rawResponse:n.content}:{guide:null,error:"\uC131\uC7A5 \uAC00\uC774\uB4DC \uD30C\uC2F1\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",rawResponse:n.content}}};var U=class{constructor(s){this.providers=new Map;this.settings=s}registerProvider(s,e){this.providers.set(s,e)}updateSettings(s){this.settings=s}getCurrentProvider(){return this.providers.get(this.settings.provider)}getCurrentApiKey(){return this.settings.apiKeys[this.settings.provider]}getCurrentModel(){return this.settings.models[this.settings.provider]}isAvailable(){let s=this.getCurrentProvider(),e=this.getCurrentApiKey();return!!s&&!!e}async generateText(s,e){let t=this.getCurrentProvider();return t?t.isAvailable()?t.generate(s,e):{success:!1,content:"",error:"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."}:{success:!1,content:"",error:"\uD504\uB85C\uBC14\uC774\uB354\uAC00 \uC120\uD0DD\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."}}async simpleGenerate(s,e,t){let i=[];return e&&i.push({role:"system",content:e}),i.push({role:"user",content:s}),this.generateText(i,t)}getAvailableProviders(){return Array.from(this.providers.keys())}isProviderConfigured(s){return!!this.settings.apiKeys[s]}},B=null;function z(c){return B=new U(c),B}function W(){return B}function J(c){B&&B.updateSettings(c)}var K=require("obsidian");var Y="growth-stage",$=class{constructor(s){this.app=s}async getById(s){return this.getByPath(s)}async getByPath(s){let e=(0,K.normalizePath)(s);if(!(this.app.vault.getAbstractFileByPath(e)instanceof this.app.vault.adapter.constructor)){let r=this.app.vault.getMarkdownFiles().find(n=>n.path===e);return r?this.fileToNoteData(r):null}return null}async getActiveNote(){let s=this.app.workspace.getActiveFile();return s?this.fileToNoteData(s):null}async getAllNotes(){let s=this.app.vault.getMarkdownFiles();return Promise.all(s.map(e=>this.fileToNoteSummary(e)))}async searchNotes(s){let e=this.app.vault.getMarkdownFiles();if(s.folder&&(e=e.filter(t=>t.path.startsWith(s.folder))),s.tags&&s.tags.length>0&&(e=e.filter(t=>{let i=this.app.metadataCache.getFileCache(t),r=this.extractTags(i);return s.tags.some(n=>r.includes(n))})),s.maturityLevel&&(e=e.filter(t=>{var n;let i=this.app.metadataCache.getFileCache(t);return((n=i==null?void 0:i.frontmatter)==null?void 0:n[Y])===s.maturityLevel})),s.hasBacklinks!==void 0&&(e=e.filter(t=>{let r=this.countBacklinks(t.path)>0;return s.hasBacklinks===r})),s.modifiedAfter){let t=s.modifiedAfter.getTime();e=e.filter(i=>i.stat.mtime>=t)}return s.limit&&s.limit>0&&(e=e.slice(0,s.limit)),Promise.all(e.map(t=>this.fileToNoteSummary(t)))}async getOutlinks(s){let e=this.getFileByPath(s);if(!e)return[];let t=this.app.metadataCache.getFileCache(e);return t!=null&&t.links?t.links.map(i=>{let r=this.app.metadataCache.getFirstLinkpathDest(i.link,e.path);return r==null?void 0:r.path}).filter(i=>!!i):[]}async getBacklinks(s){let e=this.getFileByPath(s);if(!e)return[];let t=[],i=this.app.metadataCache.resolvedLinks;for(let[r,n]of Object.entries(i))n[e.path]!==void 0&&t.push(r);return t}async updateMetadata(s,e){let t=this.getFileByPath(s);if(!t)throw new Error(`Note not found: ${s}`);await this.app.fileManager.processFrontMatter(t,i=>{Object.assign(i,e)})}async updateMaturityLevel(s,e){await this.updateMetadata(s,{[Y]:e.level})}async updateContent(s,e){let t=this.getFileByPath(s);if(!t)throw new Error(`Note not found: ${s}`);await this.app.vault.modify(t,e)}async createNote(s,e,t){let i=(0,K.normalizePath)(s),r=e;t&&(r=`---
${this.metadataToFrontmatter(t)}---

${e}`);try{let n=await this.app.vault.create(i,r),o=await this.fileToNoteData(n);if(!o)throw new Error(`Failed to create note: ${i}`);return o}catch(n){if((n instanceof Error?n.message:String(n)).toLowerCase().includes("already exists")){await this.app.vault.adapter.write(i,r);let a=this.getFileByPath(i);if(!a)throw new Error(`Failed to create note: ${i}`);let l=await this.fileToNoteData(a);if(!l)throw new Error(`Failed to create note: ${i}`);return l}throw n}}async exists(s){let e=(0,K.normalizePath)(s);if(this.app.vault.getAbstractFileByPath(e)!==null)return!0;try{return await this.app.vault.adapter.exists(e)}catch(i){return!1}}async getNotesByTag(s){return this.searchNotes({tags:[s]})}async getNotesByMaturity(s){return this.searchNotes({maturityLevel:s.level})}getFileByPath(s){var i;let e=(0,K.normalizePath)(s);return(i=this.app.vault.getMarkdownFiles().find(r=>r.path===e))!=null?i:null}async fileToNoteData(s){try{let e=await this.app.vault.cachedRead(s),t=this.app.metadataCache.getFileCache(s),i=this.extractMetadata(t,s);return{id:s.path,path:s.path,basename:s.basename,content:e,metadata:i}}catch(e){return null}}async fileToNoteSummary(s){var o,a;let e=this.app.metadataCache.getFileCache(s),t=this.extractTags(e),i=this.extractMaturityLevel(e),r=(a=(o=e==null?void 0:e.links)==null?void 0:o.length)!=null?a:0,n=this.countBacklinks(s.path);return{id:s.path,path:s.path,basename:s.basename,tags:t,maturityLevel:i,linkCount:r,backlinkCount:n}}countBacklinks(s){let e=this.app.metadataCache.resolvedLinks,t=0;for(let i of Object.values(e))i[s]!==void 0&&t++;return t}extractMetadata(s,e){var i,r,n,o,a;let t=(i=s==null?void 0:s.frontmatter)!=null?i:{};return{title:(r=t.title)!=null?r:e.basename,tags:this.extractTags(s),aliases:(n=t.aliases)!=null?n:[],created:(o=t.created)!=null?o:e.stat.ctime.toString(),modified:(a=t.modified)!=null?a:e.stat.mtime.toString(),growthStage:t[Y],...t}}extractTags(s){var t;let e=[];if((t=s==null?void 0:s.frontmatter)!=null&&t.tags){let i=s.frontmatter.tags;Array.isArray(i)?e.push(...i):typeof i=="string"&&e.push(i)}return s!=null&&s.tags&&e.push(...s.tags.map(i=>i.tag.replace("#",""))),[...new Set(e)]}extractMaturityLevel(s){var t;let e=(t=s==null?void 0:s.frontmatter)==null?void 0:t[Y];return e&&["seed","sprout","tree","evergreen"].includes(e)?m.create(e):m.default()}metadataToFrontmatter(s){let e=[];for(let[t,i]of Object.entries(s))if(i!=null)if(Array.isArray(i))i.length>0&&(e.push(`${t}:`),i.forEach(r=>e.push(`  - ${r}`)));else{if(typeof i=="object")continue;e.push(`${t}: ${i}`)}return e.join(`
`)+`
`}};var ce=require("obsidian");var L=class{constructor(){this.apiKey="";this.model=""}get modelId(){return this.model||this.config.defaultModel}get config(){return S[this.providerType]}setApiKey(s){this.apiKey=s}setModel(s){this.model=s}isAvailable(){return!!this.apiKey}async makeRequest(s){try{return(await(0,ce.requestUrl)(s)).json}catch(e){throw this.normalizeError(e)}}handleError(s){return typeof s=="object"&&s!==null&&"message"in s&&"code"in s?{success:!1,content:"",error:s.message}:{success:!1,content:"",error:this.normalizeError(s).message}}normalizeError(s){return console.error("[Evergreen Cultivator] API Error:",s),s instanceof Error?s.message.includes("429")||s.message.includes("rate")?{message:"\uC694\uCCAD \uD55C\uB3C4\uB97C \uCD08\uACFC\uD588\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",code:"RATE_LIMIT"}:s.message.includes("401")||s.message.includes("403")?{message:"API \uD0A4\uAC00 \uC720\uD6A8\uD558\uC9C0 \uC54A\uAC70\uB098 \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.",code:"AUTH_ERROR"}:s.message.includes("timeout")||s.message.includes("ETIMEDOUT")?{message:"\uC694\uCCAD \uC2DC\uAC04\uC774 \uCD08\uACFC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",code:"TIMEOUT"}:{message:s.message,code:"UNKNOWN"}:{message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.",code:"UNKNOWN"}}async simpleGenerate(s,e,t){let i=[];return e&&i.push({role:"system",content:e}),i.push({role:"user",content:s}),this.generate(i,t)}};var G=class extends L{constructor(){super(...arguments);this.providerType="claude";this.name="Anthropic Claude";this.API_VERSION="2023-06-01"}async testApiKey(e){try{let t=await this.makeRequest({url:`${this.config.endpoint}/messages`,method:"POST",headers:{"x-api-key":e,"anthropic-version":this.API_VERSION,"Content-Type":"application/json"},body:JSON.stringify({model:this.config.defaultModel,messages:[{role:"user",content:"Hello"}],max_tokens:10})});return!t.error&&!!t.content}catch(t){return!1}}async generate(e,t){var o,a;if(!this.isAvailable())return{success:!1,content:"",error:"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."};let{claudeMessages:i,systemPrompt:r}=this.convertMessages(e),n={model:this.modelId,messages:i,max_tokens:(o=t==null?void 0:t.maxTokens)!=null?o:4096,temperature:(a=t==null?void 0:t.temperature)!=null?a:.7};r&&(n.system=r),console.log("[Evergreen Cultivator] Claude API Request:",{model:this.modelId,messagesCount:i.length,hasSystemPrompt:!!r,maxTokens:n.max_tokens});try{let l=await this.makeRequest({url:`${this.config.endpoint}/messages`,method:"POST",headers:{"x-api-key":this.apiKey,"anthropic-version":this.API_VERSION,"Content-Type":"application/json"},body:JSON.stringify(n)});return l.error?{success:!1,content:"",error:l.error.message}:{success:!0,content:l.content.filter(u=>u.type==="text").map(u=>u.text).join(""),usage:l.usage?{inputTokens:l.usage.input_tokens,outputTokens:l.usage.output_tokens,totalTokens:l.usage.input_tokens+l.usage.output_tokens}:void 0}}catch(l){return this.handleError(l)}}convertMessages(e){let t=[],i=null;for(let r of e)r.role==="system"?i=r.content:t.push({role:r.role,content:r.content});return{claudeMessages:t,systemPrompt:i}}};var R=class extends L{constructor(){super(...arguments);this.providerType="openai";this.name="OpenAI"}async testApiKey(e){try{let t=this.config.defaultModel,i=t.startsWith("gpt-5")||t.startsWith("o1")||t.startsWith("o3"),r={model:t,messages:[{role:"user",content:"Hello"}]};i?r.max_completion_tokens=10:r.max_tokens=10;let n=await this.makeRequest({url:`${this.config.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(r)});return!n.error&&n.choices&&n.choices.length>0}catch(t){return!1}}async generate(e,t){var o,a,l,d,u,p,h;if(!this.isAvailable())return{success:!1,content:"",error:"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."};let i=e.map(g=>({role:g.role,content:g.content})),r=this.modelId.startsWith("gpt-5")||this.modelId.startsWith("o1")||this.modelId.startsWith("o3"),n={model:this.modelId,messages:i,temperature:(o=t==null?void 0:t.temperature)!=null?o:.7};r?n.max_completion_tokens=(a=t==null?void 0:t.maxTokens)!=null?a:4096:n.max_tokens=(l=t==null?void 0:t.maxTokens)!=null?l:4096,(t==null?void 0:t.topP)!==void 0&&(n.top_p=t.topP),t!=null&&t.stopSequences&&(n.stop=t.stopSequences),console.log("[Evergreen Cultivator] OpenAI API Request:",{model:this.modelId,isReasoningModel:r,messagesCount:i.length});try{let g=await this.makeRequest({url:`${this.config.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(n)});return g.error?{success:!1,content:"",error:g.error.message}:{success:!0,content:(h=(p=(u=(d=g.choices)==null?void 0:d[0])==null?void 0:u.message)==null?void 0:p.content)!=null?h:"",usage:g.usage?{inputTokens:g.usage.prompt_tokens,outputTokens:g.usage.completion_tokens,totalTokens:g.usage.total_tokens}:void 0}}catch(g){return this.handleError(g)}}};var O=class extends L{constructor(){super(...arguments);this.providerType="gemini";this.name="Google Gemini"}async testApiKey(e){try{let t=this.config.defaultModel,i=`${this.config.endpoint}/models/${t}:generateContent?key=${e}`,r=await this.makeRequest({url:i,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:"Hello"}]}],generationConfig:{maxOutputTokens:10}})});return!r.error&&!!r.candidates&&r.candidates.length>0}catch(t){return!1}}async generate(e,t){var o,a,l,d,u,p,h;if(!this.isAvailable())return{success:!1,content:"",error:"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."};let{contents:i,systemInstruction:r}=this.convertMessages(e),n={contents:i,generationConfig:{maxOutputTokens:(o=t==null?void 0:t.maxTokens)!=null?o:4096,temperature:(a=t==null?void 0:t.temperature)!=null?a:.7}};r&&(n.systemInstruction=r),(t==null?void 0:t.topP)!==void 0&&n.generationConfig&&(n.generationConfig.topP=t.topP),t!=null&&t.stopSequences&&n.generationConfig&&(n.generationConfig.stopSequences=t.stopSequences),console.log("[Evergreen Cultivator] Gemini API Request:",{model:this.modelId,contentsCount:i.length,hasSystemInstruction:!!r});try{let g=`${this.config.endpoint}/models/${this.modelId}:generateContent?key=${this.apiKey}`,y=await this.makeRequest({url:g,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return y.error?{success:!1,content:"",error:y.error.message}:{success:!0,content:(h=(p=(u=(d=(l=y.candidates)==null?void 0:l[0])==null?void 0:d.content)==null?void 0:u.parts)==null?void 0:p.map(A=>A.text).join(""))!=null?h:"",usage:y.usageMetadata?{inputTokens:y.usageMetadata.promptTokenCount,outputTokens:y.usageMetadata.candidatesTokenCount,totalTokens:y.usageMetadata.promptTokenCount+y.usageMetadata.candidatesTokenCount}:void 0}}catch(g){return this.handleError(g)}}convertMessages(e){let t=[],i=null;for(let r of e)r.role==="system"?i={parts:[{text:r.content}]}:t.push({role:r.role==="assistant"?"model":"user",parts:[{text:r.content}]});return{contents:t,systemInstruction:i}}};var F=class extends L{constructor(){super(...arguments);this.providerType="grok";this.name="xAI Grok"}async testApiKey(e){try{let t=await this.makeRequest({url:`${this.config.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.config.defaultModel,messages:[{role:"user",content:"Hello"}],max_tokens:10})});return!t.error&&t.choices&&t.choices.length>0}catch(t){return!1}}async generate(e,t){var n,o,a,l,d,u;if(!this.isAvailable())return{success:!1,content:"",error:"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."};let i=e.map(p=>({role:p.role,content:p.content})),r={model:this.modelId,messages:i,max_tokens:(n=t==null?void 0:t.maxTokens)!=null?n:4096,temperature:(o=t==null?void 0:t.temperature)!=null?o:.7};(t==null?void 0:t.topP)!==void 0&&(r.top_p=t.topP),t!=null&&t.stopSequences&&(r.stop=t.stopSequences),console.log("[Evergreen Cultivator] Grok API Request:",{model:this.modelId,messagesCount:i.length});try{let p=await this.makeRequest({url:`${this.config.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(r)});return p.error?{success:!1,content:"",error:p.error.message}:{success:!0,content:(u=(d=(l=(a=p.choices)==null?void 0:a[0])==null?void 0:l.message)==null?void 0:d.content)!=null?u:"",usage:p.usage?{inputTokens:p.usage.prompt_tokens,outputTokens:p.usage.completion_tokens,totalTokens:p.usage.total_tokens}:void 0}}catch(p){return this.handleError(p)}}};var f=require("obsidian");var j="evergreen-cultivator-view",Ce="assessment";var ne=/(^>\s*\[!assessment\][+-]?\s*.*\n(?:>.*\n?)*)/m,Z=class extends f.ItemView{constructor(e,t){super(e);this.currentFile=null;this.lastAssessment=null;this.dynamicContentEl=null;this.isLoadedFromNote=!1;this.plugin=t}getViewType(){return j}getDisplayText(){return"Evergreen Cultivator"}getIcon(){return"sprout"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("cultivator-view-container"),this.registerEvent(this.app.workspace.on("file-open",i=>{this.onFileOpen(i)})),this.registerEvent(this.app.metadataCache.on("changed",i=>{this.currentFile&&i.path===this.currentFile.path&&this.renderNoteInfo(this.currentFile)}));let t=this.app.workspace.getActiveFile();t?await this.onFileOpen(t):this.renderEmptyState()}async onClose(){}async onFileOpen(e){if(this.currentFile=e,this.lastAssessment=null,this.isLoadedFromNote=!1,!e){this.renderEmptyState();return}if(e.extension!=="md"){this.renderNonMarkdownState();return}await this.loadAssessmentFromNote(e),await this.renderNoteInfo(e)}renderEmptyState(){let e=this.containerEl.children[1];e.empty();let t=e.createDiv({cls:"cultivator-empty"});t.createEl("div",{cls:"cultivator-icon",text:"\u{1F331}"}),t.createEl("p",{text:"Open a note to check its growth status"})}renderNonMarkdownState(){let e=this.containerEl.children[1];e.empty();let t=e.createDiv({cls:"cultivator-empty"});t.createEl("div",{cls:"cultivator-icon",text:"\u{1F4C4}"}),t.createEl("p",{text:"Only available for markdown notes"})}async renderNoteInfo(e){var y,b,A;let t=this.containerEl.children[1];t.empty();let i=t.createDiv({cls:"cultivator-header"}),r=this.app.metadataCache.getFileCache(e),n=(y=r==null?void 0:r.frontmatter)==null?void 0:y[this.plugin.settings.frontmatterKey],o=n?m.fromFrontmatter(n):m.default();i.createEl("div",{cls:"cultivator-maturity-icon",text:o.icon}),i.createEl("h3",{cls:"cultivator-maturity-text",text:o.displayName}),i.createEl("p",{cls:"cultivator-maturity-desc",text:o.description}),t.createEl("h4",{cls:"cultivator-note-title",text:e.basename});let a=t.createDiv({cls:"cultivator-stats"}),d=(await this.app.vault.cachedRead(e)).split(/\s+/).filter(oe=>oe.length>0).length,u=(A=(b=r==null?void 0:r.links)==null?void 0:b.length)!=null?A:0,p=this.countTags(r);this.renderStat(a,"\u{1F4DD}","Words",d.toString()),this.renderStat(a,"\u{1F517}","Links",u.toString()),this.renderStat(a,"\u{1F3F7}\uFE0F","Tags",p.toString()),t.createDiv({cls:"cultivator-actions"}).createEl("button",{cls:"cultivator-btn cultivator-btn-primary",text:"\u{1F50D} Assess Quality"}).addEventListener("click",()=>this.runAssessment()),this.dynamicContentEl=t.createDiv({cls:"cultivator-dynamic-content"}),this.renderDynamicContent()}renderDynamicContent(){var e;if(this.dynamicContentEl)if(this.dynamicContentEl.empty(),(e=this.lastAssessment)!=null&&e.assessment)this.isLoadedFromNote&&this.dynamicContentEl.createDiv({cls:"cultivator-loaded-indicator"}).createEl("span",{text:"\u{1F4C2} Loaded saved assessment"}),this.renderAssessmentResults(this.dynamicContentEl,this.lastAssessment),this.renderGrowthGuideSection(this.dynamicContentEl),this.dynamicContentEl.createDiv({cls:"cultivator-save-actions"}).createEl("button",{cls:"cultivator-btn cultivator-btn-save",text:"\u{1F4DD} Save to Note"}).addEventListener("click",()=>this.saveAssessmentToNote());else{let t=this.dynamicContentEl.createDiv({cls:"cultivator-guide"});t.createEl("h4",{text:"\u{1F331} Growth Guide"}),t.createDiv({cls:"cultivator-tip"}).createEl("p",{text:"Run a quality assessment to receive specific guidance for growing to the next stage."})}}renderLoadingInDynamicArea(){if(!this.dynamicContentEl)return;this.dynamicContentEl.empty();let e=this.dynamicContentEl.createDiv({cls:"cultivator-loading"});e.createDiv({cls:"cultivator-spinner-wrapper"}).createDiv({cls:"cultivator-spinner"}),e.createEl("p",{cls:"cultivator-loading-text",text:"AI is evaluating note quality..."})}renderStat(e,t,i,r){let n=e.createDiv({cls:"cultivator-stat"});n.createEl("span",{cls:"cultivator-stat-icon",text:t}),n.createEl("span",{cls:"cultivator-stat-label",text:i}),n.createEl("span",{cls:"cultivator-stat-value",text:r})}countTags(e){var i;let t=0;if((i=e==null?void 0:e.frontmatter)!=null&&i.tags){let r=e.frontmatter.tags;Array.isArray(r)?t+=r.length:typeof r=="string"&&(t+=1)}return e!=null&&e.tags&&(t+=e.tags.length),t}async buildNoteData(e){var n,o,a;let t=await this.app.vault.cachedRead(e),i=this.app.metadataCache.getFileCache(e),r=(n=i==null?void 0:i.frontmatter)==null?void 0:n[this.plugin.settings.frontmatterKey];return{id:e.path,path:e.path,basename:e.basename,content:t,metadata:{title:e.basename,tags:(a=(o=i==null?void 0:i.frontmatter)==null?void 0:o.tags)!=null?a:[],growthStage:r}}}getExistingLinks(e){var i,r;let t=this.app.metadataCache.getFileCache(e);return(r=(i=t==null?void 0:t.links)==null?void 0:i.map(n=>n.link))!=null?r:[]}getBacklinks(e){let t=this.app.metadataCache.resolvedLinks,i=[];for(let[r,n]of Object.entries(t))n[e.path]!==void 0&&r!==e.path&&i.push(r);return i}async runAssessment(){var i;if(!this.currentFile){new f.Notice("Please open a note first.");return}let e=this.plugin.getAIService();if(!(e!=null&&e.isAvailable())){new f.Notice("Please complete AI settings first.");return}let t=e.getCurrentProvider();if(!t){new f.Notice("AI provider not found.");return}this.renderLoadingInDynamicArea();try{let r=await this.buildNoteData(this.currentFile),n=this.getExistingLinks(this.currentFile),o=this.getBacklinks(this.currentFile),l=await new T(t).execute({note:r,existingLinks:n,backlinks:o});l.assessment?(this.lastAssessment=l,this.renderDynamicContent(),new f.Notice("\u2705 Assessment complete!")):(this.renderDynamicContent(),new f.Notice(`\u274C Assessment failed: ${(i=l.error)!=null?i:"Unknown error"}`))}catch(r){this.renderDynamicContent();let n=r instanceof Error?r.message:"Unknown error";new f.Notice(`\u274C Error: ${n}`)}}renderAssessmentResults(e,t){var d;if(!t.assessment)return;let i=e.createDiv({cls:"cultivator-results"});i.createEl("h4",{text:"\u{1F4CA} Assessment Results"});let r=t.assessment,n=r.qualityScore,o=i.createDiv({cls:"cultivator-score"});o.createEl("span",{cls:"cultivator-score-value",text:`${n.totalScore}pts`}),o.createEl("span",{cls:"cultivator-score-grade",text:n.getGrade()});let a=i.createDiv({cls:"cultivator-dimensions"});n.getAllDimensions().forEach(u=>{this.renderDimensionBar(a,u)});let l=r.recommendedMaturity;if(l){let u=i.createDiv({cls:"cultivator-recommendation"}),p=u.createDiv({cls:"cultivator-recommendation-left"});p.createEl("span",{cls:"cultivator-recommendation-label",text:"Recommended:"}),p.createEl("span",{cls:"cultivator-recommendation-value",text:`${l.icon} ${l.displayName}`});let h=this.app.metadataCache.getFileCache(this.currentFile),g=(d=h==null?void 0:h.frontmatter)==null?void 0:d[this.plugin.settings.frontmatterKey];(g?m.fromFrontmatter(g):m.default()).level!==l.level?u.createEl("button",{cls:"cultivator-btn-update",text:"Update"}).addEventListener("click",()=>this.updateMaturityToRecommended(l)):u.createEl("span",{cls:"cultivator-recommendation-match",text:"\u2713 Match"})}}async updateMaturityToRecommended(e){var t,i;if(this.currentFile)try{let r=this.app.metadataCache.getFileCache(this.currentFile),n=(t=r==null?void 0:r.frontmatter)==null?void 0:t[this.plugin.settings.frontmatterKey],o=n?m.fromFrontmatter(n):m.default(),l=await new C(this.plugin.getNoteRepository()).execute({noteId:this.currentFile.path,currentMaturity:o,targetMaturity:e,forceUpdate:!0});l.success?(new f.Notice(`\u2705 Maturity updated to ${e.icon} ${e.displayName}.`),await this.renderNoteInfo(this.currentFile)):new f.Notice(`\u274C Update failed: ${(i=l.error)!=null?i:"Unknown error"}`)}catch(r){let n=r instanceof Error?r.message:"Unknown error";new f.Notice(`\u274C Error: ${n}`)}}renderDimensionBar(e,t){let i=e.createDiv({cls:"cultivator-dimension"}),r=i.createDiv({cls:"cultivator-dimension-label"});r.createEl("span",{text:`${t.icon} ${t.displayName}`}),r.createEl("span",{text:`${t.score}pts`});let o=i.createDiv({cls:"cultivator-dimension-bar-bg"}).createDiv({cls:"cultivator-dimension-bar-fill"});o.style.width=`${t.score}%`,t.score>=80?o.addClass("cultivator-bar-excellent"):t.score>=60?o.addClass("cultivator-bar-good"):t.score>=40?o.addClass("cultivator-bar-fair"):o.addClass("cultivator-bar-poor")}renderGrowthGuideSection(e){var i,r;let t=e.createDiv({cls:"cultivator-guide"});t.createEl("h4",{text:"\u{1F331} Growth Guide"}),(r=(i=this.lastAssessment)==null?void 0:i.assessment)!=null&&r.improvements&&this.lastAssessment.assessment.improvements.length>0?this.renderImprovementsList(t,this.lastAssessment.assessment.improvements):t.createDiv({cls:"cultivator-tip"}).createEl("p",{text:"No improvement suggestions. Excellent note!"})}renderImprovementsList(e,t){let i=e.createDiv({cls:"cultivator-improvements"});t.forEach((r,n)=>{let o=i.createDiv({cls:"cultivator-improvement-item"}),a=r.priority==="high"?"\u{1F534}":r.priority==="medium"?"\u{1F7E1}":"\u{1F7E2}",l=r.priority==="high"?"High":r.priority==="medium"?"Medium":"Low",d=o.createDiv({cls:"cultivator-improvement-header"});if(d.createEl("span",{cls:"cultivator-improvement-number",text:`${n+1}`}),d.createEl("span",{cls:"cultivator-improvement-dimension",text:r.dimension}),d.createEl("span",{cls:`cultivator-improvement-priority cultivator-priority-${r.priority}`,text:`${a} ${l}`}),o.createEl("p",{cls:"cultivator-improvement-suggestion",text:r.suggestion}),r.example){let u=o.createDiv({cls:"cultivator-improvement-example"});u.createEl("span",{cls:"cultivator-example-label",text:"\u{1F4A1} Example: "}),u.createEl("span",{text:r.example})}})}generateAssessmentCallout(){var n;if(!((n=this.lastAssessment)!=null&&n.assessment))return"";let e=this.lastAssessment.assessment,t=e.qualityScore,i=new Date().toISOString().split("T")[0],r=[];return r.push(`> [!${Ce}]- \u{1F4CA} Quality Assessment Results (${i})`),r.push(`> **Total Score**: ${t.totalScore}pts (${t.getGrade()})`),e.recommendedMaturity&&r.push(`> **Recommended Maturity**: ${e.recommendedMaturity.icon} ${e.recommendedMaturity.displayName}`),r.push(">"),r.push("> | Dimension | Score | Feedback |"),r.push("> |-----------|-------|----------|"),e.improvements.forEach(o=>{let a=o.suggestion.replace(/\|/g,"\\|").replace(/\n/g," "),l=a.length>100?a.substring(0,100)+"...":a;r.push(`> | ${o.dimension} | ${this.getScoreForDimension(o.dimension)}pts | ${l} |`)}),r.join(`
`)}getScoreForDimension(e){var o,a;if(!((o=this.lastAssessment)!=null&&o.assessment))return 0;let i=this.lastAssessment.assessment.qualityScore.getAllDimensions(),r={Atomicity:"Atomicity",Connectivity:"Connectivity",Clarity:"Clarity",Evidence:"Evidence",Originality:"Originality"},n=i.find(l=>l.displayName===e);return(a=n==null?void 0:n.score)!=null?a:0}async saveAssessmentToNote(){var e;if(!this.currentFile||!((e=this.lastAssessment)!=null&&e.assessment)){new f.Notice("No assessment results to save.");return}try{let t=this.generateAssessmentCallout();if(!t){new f.Notice("Failed to generate callout.");return}let i=await this.app.vault.read(this.currentFile);ne.test(i)?(i=i.replace(ne,t),new f.Notice("\u2705 Assessment results updated.")):(i=i.replace(/\s+$/,"")+`

`+t+`
`,new f.Notice("\u2705 Assessment results saved to note.")),await this.app.vault.modify(this.currentFile,i),this.isLoadedFromNote=!0}catch(t){let i=t instanceof Error?t.message:"Unknown error";new f.Notice(`\u274C Save failed: ${i}`)}}async loadAssessmentFromNote(e){try{let i=(await this.app.vault.cachedRead(e)).match(ne);if(!i)return;let r=i[1],n=this.parseAssessmentCallout(r);n&&(this.lastAssessment=n,this.isLoadedFromNote=!0)}catch(t){console.error("Failed to load assessment from note:",t)}}parseAssessmentCallout(e){var t,i,r,n;try{let o=e.split(`
`).map(M=>M.replace(/^>\s?/,"")),a=o.find(M=>M.includes("**Total Score**")),l=a==null?void 0:a.match(/(\d+)pts/),d=l?parseInt(l[1]):0,u=o.find(M=>M.includes("**Recommended Maturity**")),p=null;u&&(u.includes("Evergreen")?p=m.create("evergreen"):u.includes("Tree")?p=m.create("tree"):u.includes("Sprout")?p=m.create("sprout"):p=m.create("seed"));let h=o.filter(M=>M.startsWith("|")&&!M.includes("---")&&!M.includes("Dimension")),g=[],y={};h.forEach(M=>{let V=M.split("|").map(P=>P.trim()).filter(P=>P);if(V.length>=3){let P=V[0],ae=V[1].match(/(\d+)/),te=ae?parseInt(ae[1]):0,le=V[2].replace(/\\\|/g,"|");y[P]={score:te,feedback:le};let ue=te>=80?"low":te>=60?"medium":"high";g.push({dimension:P,priority:ue,suggestion:le})}});let b=w.fromScores({atomicity:y.Atomicity||{score:0,feedback:""},connectivity:y.Connectivity||{score:0,feedback:""},clarity:y.Clarity||{score:0,feedback:""},evidence:y.Evidence||{score:0,feedback:""},originality:y.Originality||{score:0,feedback:""}}),A=m.default();return{assessment:k.create({noteId:(i=(t=this.currentFile)==null?void 0:t.path)!=null?i:"",notePath:(n=(r=this.currentFile)==null?void 0:r.path)!=null?n:"",qualityScore:b,currentMaturity:A,improvements:g,splitSuggestion:null})}}catch(o){return console.error("Failed to parse assessment callout:",o),null}}};var Q=require("obsidian");var q=class extends Q.Modal{constructor(e,t,i,r="assess"){super(e);this.assessment=null;this.connections=null;this.growthGuide=null;this.isLoading=!1;this.plugin=t,this.file=i,this.mode=r}async onOpen(){let{contentEl:e}=this;e.addClass("assessment-modal"),this.renderHeader(),await this.runAnalysis()}onClose(){let{contentEl:e}=this;e.empty()}renderHeader(){let{contentEl:e}=this,t=e.createDiv({cls:"assessment-modal-header"});t.createEl("h2",{text:"\u{1F331} Evergreen Note Cultivator"}),t.createEl("p",{cls:"assessment-modal-subtitle",text:this.file.basename})}async buildNoteData(){var r,n,o;let e=await this.app.vault.cachedRead(this.file),t=this.app.metadataCache.getFileCache(this.file),i=(r=t==null?void 0:t.frontmatter)==null?void 0:r[this.plugin.settings.frontmatterKey];return{id:this.file.path,path:this.file.path,basename:this.file.basename,content:e,metadata:{title:this.file.basename,tags:(o=(n=t==null?void 0:t.frontmatter)==null?void 0:n.tags)!=null?o:[],growthStage:i}}}getExistingLinks(){var t,i;let e=this.app.metadataCache.getFileCache(this.file);return(i=(t=e==null?void 0:e.links)==null?void 0:t.map(r=>r.link))!=null?i:[]}getBacklinks(){let e=this.app.metadataCache.resolvedLinks,t=[];for(let[i,r]of Object.entries(e))r[this.file.path]!==void 0&&i!==this.file.path&&t.push(i);return t}async runAnalysis(){let{contentEl:e}=this;this.isLoading=!0;let t=e.createDiv({cls:"assessment-loading"});t.createEl("div",{cls:"assessment-spinner"}),t.createEl("p",{text:"Analyzing..."});let i=this.plugin.getAIService();if(!(i!=null&&i.isAvailable())){t.empty(),t.createDiv({cls:"assessment-error"}).createEl("p",{text:"\u274C Please complete AI settings first. (Settings \u2192 Evergreen Note Cultivator)"}),this.isLoading=!1;return}let r=i.getCurrentProvider();if(!r){t.empty(),t.createDiv({cls:"assessment-error"}).createEl("p",{text:"\u274C AI provider not found."}),this.isLoading=!1;return}try{let n=await this.buildNoteData(),o=this.getExistingLinks(),a=this.getBacklinks(),l=new T(r);if(this.assessment=await l.execute({note:n,existingLinks:o,backlinks:a}),this.assessment.assessment){let d=this.assessment.assessment.currentMaturity,u=this.assessment.assessment.qualityScore,p=new _(r);this.growthGuide=await p.execute({note:n,currentMaturity:d,qualityScore:u})}if(this.plugin.settings.assessment.enableConnectionSuggestions&&this.assessment.assessment){let p=(await this.plugin.getNoteRepository().getAllNotes()).filter(h=>h.path!==this.file.path).slice(0,20);if(p.length>0){let h=new N(r);this.connections=await h.execute({note:n,candidateNotes:p})}}t.remove(),this.isLoading=!1,this.renderResults()}catch(n){t.empty();let o=n instanceof Error?n.message:"Unknown error";t.createDiv({cls:"assessment-error"}).createEl("p",{text:`\u274C Analysis failed: ${o}`}),this.isLoading=!1}}renderResults(){var o,a,l;let{contentEl:e}=this;if(!((o=this.assessment)!=null&&o.assessment)){e.createDiv({cls:"assessment-error"}).createEl("p",{text:`\u274C Assessment failed: ${(l=(a=this.assessment)==null?void 0:a.error)!=null?l:"Unknown error"}`});return}let t=this.assessment.assessment,i=e.createDiv({cls:"assessment-tabs"}),r=[{id:"overview",label:"\u{1F4CA} Overview"},{id:"dimensions",label:"\u{1F4CF} Dimension Analysis"},{id:"suggestions",label:"\u{1F4A1} Improvements"},{id:"connections",label:"\u{1F517} Connections"},{id:"growth",label:"\u{1F331} Growth Guide"}],n=e.createDiv({cls:"assessment-tab-content"});r.forEach((d,u)=>{let p=i.createEl("button",{cls:"assessment-tab"+(u===0?" is-active":""),text:d.label});p.addEventListener("click",()=>{i.querySelectorAll(".assessment-tab").forEach(h=>h.removeClass("is-active")),p.addClass("is-active"),this.renderTabContent(n,d.id)})}),this.renderTabContent(n,"overview")}renderTabContent(e,t){switch(e.empty(),t){case"overview":this.renderOverviewTab(e);break;case"dimensions":this.renderDimensionsTab(e);break;case"suggestions":this.renderSuggestionsTab(e);break;case"connections":this.renderConnectionsTab(e);break;case"growth":this.renderGrowthTab(e);break}}renderOverviewTab(e){var u;if(!((u=this.assessment)!=null&&u.assessment))return;let t=this.assessment.assessment,i=e.createDiv({cls:"assessment-score-card"});i.createDiv({cls:"assessment-score-circle"}).createEl("span",{text:`${t.qualityScore.totalScore}`});let n=i.createDiv({cls:"assessment-score-info"});n.createEl("h4",{text:`Grade: ${t.qualityScore.getGrade()}`}),n.createEl("p",{text:t.qualityScore.getStatusText()});let o=t.currentMaturity,a=t.recommendedMaturity,l=e.createDiv({cls:"assessment-current-stage"});l.createDiv({cls:"stage-icon",text:o.icon}),l.createEl("h4",{text:o.displayName}),l.createEl("p",{text:o.description}),a&&a.isHigherThan(o)&&(e.createDiv({cls:"cultivator-recommendation"}).createEl("p",{text:`\u2728 Recommended: ${a.icon} ${a.displayName}`}),e.createEl("button",{cls:"assessment-update-btn",text:`Upgrade Maturity: ${a.getDisplayText()}`}).addEventListener("click",()=>this.updateMaturity(a)));let d=e.createDiv({cls:"assessment-summary"});d.createEl("h4",{text:"Summary"}),d.createEl("p",{text:t.getSummaryText()})}renderDimensionsTab(e){var r;if(!((r=this.assessment)!=null&&r.assessment))return;let t=this.assessment.assessment,i=e.createDiv({cls:"assessment-dimension-list"});t.qualityScore.getAllDimensions().forEach(n=>{let o=i.createDiv({cls:"assessment-dimension-card"}),a=o.createDiv({cls:"assessment-dimension-header"});a.createDiv({cls:"assessment-dimension-title"}).createEl("span",{text:`${n.icon} ${n.displayName}`}),a.createEl("span",{cls:"assessment-dimension-score",text:`${n.score}pts`});let u=o.createDiv({cls:"cultivator-dimension-bar-bg"}).createDiv({cls:"cultivator-dimension-bar-fill"});u.style.width=`${n.score}%`,n.score>=80?u.addClass("cultivator-bar-excellent"):n.score>=60?u.addClass("cultivator-bar-good"):n.score>=40?u.addClass("cultivator-bar-fair"):u.addClass("cultivator-bar-poor"),n.feedback&&o.createEl("p",{cls:"assessment-dimension-feedback",text:n.feedback})})}renderSuggestionsTab(e){var n;if(!((n=this.assessment)!=null&&n.assessment))return;let t=this.assessment.assessment,i=t.improvements;if(i&&i.length>0){let o=e.createDiv({cls:"assessment-suggestion-list"});i.forEach(a=>{let l=o.createDiv({cls:"assessment-suggestion-card"});l.createEl("h4",{text:`[${a.priority.toUpperCase()}] ${a.dimension}`}),l.createEl("p",{text:a.suggestion}),a.example&&l.createEl("p",{cls:"assessment-dimension-feedback",text:`Example: ${a.example}`})})}let r=t.splitSuggestion;if(r){let o=e.createDiv({cls:"assessment-suggestion-list"});o.createEl("h4",{text:"\u2702\uFE0F Split Suggestion"}),o.createEl("p",{cls:"assessment-dimension-feedback",text:"This note covers multiple topics and splitting is recommended."});let a=o.createDiv({cls:"assessment-suggestion-card"});if(a.createEl("h4",{text:"Reason for Split"}),a.createEl("p",{text:r.reason}),r.suggestedNotes&&r.suggestedNotes.length>0){let l=o.createDiv({cls:"assessment-suggestion-card"});l.createEl("h4",{text:"Suggested New Notes"}),r.suggestedNotes.forEach((d,u)=>{let p=l.createDiv();p.createEl("p",{text:`${u+1}. ${d.title}`}),p.createEl("p",{cls:"assessment-dimension-feedback",text:d.description})})}}(!i||i.length===0)&&!r&&e.createEl("p",{cls:"cultivator-empty",text:"No improvement suggestions. Excellent note!"})}renderConnectionsTab(e){var r;let t=(r=this.connections)==null?void 0:r.suggestions;if(!t||t.length===0){e.createEl("p",{cls:"cultivator-empty",text:"No connection suggestions."});return}let i=e.createDiv({cls:"assessment-connection-list"});t.forEach(n=>{let o=i.createDiv({cls:"assessment-connection-item"});o.createDiv({cls:"assessment-connection-relevance"}).createEl("span",{text:n.relationshipType});let l=o.createDiv({cls:"assessment-connection-info"});if(l.createEl("div",{cls:"assessment-connection-title",text:n.targetNote}),l.createEl("div",{cls:"assessment-connection-reason",text:n.reason}),n.linkSuggestion){let d=l.createDiv({cls:"assessment-connection-reason"});d.createEl("span",{text:"Suggestion: "}),d.createEl("code",{text:n.linkSuggestion})}o.addEventListener("click",()=>{let d=this.app.metadataCache.getFirstLinkpathDest(n.targetNote,this.file.path);d&&this.app.workspace.getLeaf().openFile(d)})})}renderGrowthTab(e){var o,a,l,d;let t=(o=this.growthGuide)==null?void 0:o.guide;if(!t){let u=(l=(a=this.growthGuide)==null?void 0:a.error)!=null?l:"Unable to generate growth guide.";e.createEl("p",{cls:"cultivator-empty",text:u});return}let i=e.createDiv({cls:"assessment-growth-guide"}),r=i.createDiv({cls:"assessment-current-stage"}),n=m.create(t.targetLevel);if(r.createDiv({cls:"stage-icon",text:n.icon}),r.createEl("h4",{text:`Target: ${n.displayName}`}),r.createEl("p",{text:`Current ${t.currentScore}pts \u2192 Target ${t.requiredScore}pts`}),t.steps&&t.steps.length>0){let u=i.createDiv({cls:"assessment-next-steps"});u.createEl("h4",{text:"\u{1F4CB} Action Steps"});let p=u.createDiv({cls:"assessment-step-list"});t.steps.forEach(h=>{let g=p.createDiv({cls:"assessment-step-item"});g.createDiv({cls:"assessment-step-number"}).createEl("span",{text:`${h.step}`});let b=g.createDiv({cls:"assessment-step-content"});b.createEl("h5",{text:h.action}),b.createEl("p",{text:h.expectedImpact})})}if(t.estimatedEffort){let u={low:"Low (10-30 min)",medium:"Medium (30 min - 1 hour)",high:"High (1+ hour)"},p=i.createDiv({cls:"assessment-suggestion-card"});p.createEl("h4",{text:"\u23F1\uFE0F Estimated Effort"}),p.createEl("p",{text:(d=u[t.estimatedEffort])!=null?d:t.estimatedEffort})}}async updateMaturity(e){var o,a;let t=this.app.metadataCache.getFileCache(this.file),i=(o=t==null?void 0:t.frontmatter)==null?void 0:o[this.plugin.settings.frontmatterKey],r=i?m.fromFrontmatter(i):m.default(),n=this.plugin.getNoteRepository();try{let d=await new C(n).execute({noteId:this.file.path,currentMaturity:r,targetMaturity:e});d.success?(new Q.Notice(`\u2705 Maturity updated to ${d.newLevel.getDisplayText()}!`),this.close()):new Q.Notice(`\u274C Update failed: ${(a=d.error)!=null?a:"Unknown error"}`)}catch(l){let d=l instanceof Error?l.message:"Unknown error";new Q.Notice(`\u274C Error: ${d}`)}}};var v=require("obsidian");var X=class extends v.PluginSettingTab{constructor(e,t){super(e,t);this.modelDropdown=null;this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h1",{text:"Evergreen Note Cultivator"}),this.renderAISettings(e),this.renderDisplaySettings(e),this.renderAssessmentSettings(e),this.renderAdvancedSettings(e)}renderAISettings(e){e.createEl("h2",{text:"AI Settings"}),new v.Setting(e).setName("AI Provider").setDesc("Select the AI service to use").addDropdown(i=>{Object.entries(S).forEach(([r,n])=>{i.addOption(r,n.displayName)}),i.setValue(this.plugin.settings.ai.provider),i.onChange(async r=>{this.plugin.settings.ai.provider=r,await this.plugin.saveSettings(),this.updateModelDropdown(),this.display()})});let t=this.plugin.settings.ai.provider;new v.Setting(e).setName(`${S[t].displayName} API Key`).setDesc("Enter your API key").addText(i=>{var r;i.setPlaceholder("Enter API key").setValue((r=this.plugin.settings.ai.apiKeys[t])!=null?r:"").onChange(async n=>{this.plugin.settings.ai.apiKeys[t]=n,await this.plugin.saveSettings()}),i.inputEl.type="password"}).addButton(i=>{i.setButtonText("Test").onClick(async()=>{let r=this.plugin.getCurrentProvider(),n=this.plugin.settings.ai.apiKeys[t];if(!r){new v.Notice("Provider not found.");return}if(!n){new v.Notice("Please enter an API key first.");return}i.setDisabled(!0),i.setButtonText("Testing...");try{await r.testApiKey(n)?new v.Notice("\u2705 API key is valid!"):new v.Notice("\u274C API key is invalid.")}catch(o){let a=o instanceof Error?o.message:"Unknown error";new v.Notice(`\u274C Test failed: ${a}`)}finally{i.setDisabled(!1),i.setButtonText("Test")}})}),new v.Setting(e).setName("Model").setDesc("Select the model to use").addDropdown(i=>{var r;this.modelDropdown=i,this.populateModelDropdown(i,t),i.setValue((r=this.plugin.settings.ai.models[t])!=null?r:S[t].defaultModel),i.onChange(async n=>{this.plugin.settings.ai.models[t]=n,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Budget Limit (USD)").setDesc("Set monthly API usage budget limit (optional)").addText(i=>{var r,n;i.setPlaceholder("e.g., 10.00").setValue((n=(r=this.plugin.settings.ai.budgetLimit)==null?void 0:r.toString())!=null?n:"").onChange(async o=>{let a=parseFloat(o);this.plugin.settings.ai.budgetLimit=isNaN(a)?void 0:a,await this.plugin.saveSettings()})})}renderDisplaySettings(e){e.createEl("h2",{text:"Display Settings"}),new v.Setting(e).setName("Show maturity in explorer").setDesc("Display note maturity icons in file explorer").addToggle(t=>{t.setValue(this.plugin.settings.display.showMaturityInExplorer).onChange(async i=>{this.plugin.settings.display.showMaturityInExplorer=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Show score in sidebar").setDesc("Display quality score in sidebar").addToggle(t=>{t.setValue(this.plugin.settings.display.showScoreInSidebar).onChange(async i=>{this.plugin.settings.display.showScoreInSidebar=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Auto-open sidebar on startup").setDesc("Automatically open sidebar when plugin loads").addToggle(t=>{t.setValue(this.plugin.settings.display.autoOpenSidebar).onChange(async i=>{this.plugin.settings.display.autoOpenSidebar=i,await this.plugin.saveSettings()})})}renderAssessmentSettings(e){e.createEl("h2",{text:"Assessment Settings"}),new v.Setting(e).setName("Auto-assess on note open").setDesc("Automatically run quality assessment when opening a note").addToggle(t=>{t.setValue(this.plugin.settings.assessment.autoAssessOnOpen).onChange(async i=>{this.plugin.settings.assessment.autoAssessOnOpen=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Show detailed feedback").setDesc("Display detailed feedback for each assessment dimension").addToggle(t=>{t.setValue(this.plugin.settings.assessment.showDetailedFeedback).onChange(async i=>{this.plugin.settings.assessment.showDetailedFeedback=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Enable split suggestions").setDesc("Show split suggestions for notes with low atomicity").addToggle(t=>{t.setValue(this.plugin.settings.assessment.enableSplitSuggestions).onChange(async i=>{this.plugin.settings.assessment.enableSplitSuggestions=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Enable connection suggestions").setDesc("Show suggestions for connections to other notes").addToggle(t=>{t.setValue(this.plugin.settings.assessment.enableConnectionSuggestions).onChange(async i=>{this.plugin.settings.assessment.enableConnectionSuggestions=i,await this.plugin.saveSettings()})})}renderAdvancedSettings(e){e.createEl("h2",{text:"Advanced Settings"}),new v.Setting(e).setName("Frontmatter key").setDesc("Frontmatter key name to store maturity level").addText(t=>{t.setPlaceholder("growth-stage").setValue(this.plugin.settings.frontmatterKey).onChange(async i=>{this.plugin.settings.frontmatterKey=i||"growth-stage",await this.plugin.saveSettings()})}),new v.Setting(e).setName("Max tokens").setDesc("Maximum tokens for AI response").addText(t=>{t.setPlaceholder("4096").setValue(this.plugin.settings.ai.maxTokens.toString()).onChange(async i=>{let r=parseInt(i);!isNaN(r)&&r>0&&(this.plugin.settings.ai.maxTokens=r,await this.plugin.saveSettings())})}),new v.Setting(e).setName("Temperature").setDesc("AI response creativity level (0.0 - 1.0)").addSlider(t=>{t.setLimits(0,1,.1).setValue(this.plugin.settings.ai.temperature).setDynamicTooltip().onChange(async i=>{this.plugin.settings.ai.temperature=i,await this.plugin.saveSettings()})})}populateModelDropdown(e,t){H(t).forEach(r=>{e.addOption(r.id,r.displayName)})}updateModelDropdown(){var t;if(!this.modelDropdown)return;let e=this.plugin.settings.ai.provider;this.modelDropdown.selectEl.empty(),this.populateModelDropdown(this.modelDropdown,e),this.modelDropdown.setValue((t=this.plugin.settings.ai.models[e])!=null?t:S[e].defaultModel)}};var D={ai:{provider:"claude",apiKeys:{},models:{},maxTokens:4096,temperature:.7},display:{showMaturityInExplorer:!0,showScoreInSidebar:!0,autoOpenSidebar:!1},assessment:{autoAssessOnOpen:!1,showDetailedFeedback:!0,enableSplitSuggestions:!0,enableConnectionSuggestions:!0},frontmatterKey:"growth-stage"};var ee=class extends x.Plugin{constructor(){super(...arguments);this.aiService=null}async onload(){await this.loadSettings(),this.noteRepository=new $(this.app),this.initializeAIService(),this.registerView(j,e=>new Z(e,this)),this.addCommand({id:"assess-current-note",name:"Assess current note quality",callback:()=>this.assessCurrentNote()}),this.addCommand({id:"show-growth-guide",name:"Show growth guide",callback:()=>this.showGrowthGuide()}),this.addCommand({id:"open-cultivator-sidebar",name:"Open Cultivator sidebar",callback:()=>this.activateView()}),this.addCommand({id:"update-maturity",name:"Update note maturity level",callback:()=>this.updateMaturity()}),this.addRibbonIcon("sprout","Evergreen Note Cultivator",()=>{this.activateView()}),this.addSettingTab(new X(this.app,this)),this.settings.display.autoOpenSidebar&&this.app.workspace.onLayoutReady(()=>{this.activateView()}),console.log("Evergreen Note Cultivator: Plugin loaded")}async onunload(){console.log("Evergreen Note Cultivator: Plugin unloaded")}async loadSettings(){let e=await this.loadData();this.settings={...D,ai:{...D.ai,apiKeys:{...D.ai.apiKeys},models:{...D.ai.models}},display:{...D.display},assessment:{...D.assessment}},e&&(e.ai&&(e.ai.provider&&(this.settings.ai.provider=e.ai.provider),e.ai.apiKeys&&(this.settings.ai.apiKeys={...this.settings.ai.apiKeys,...e.ai.apiKeys}),e.ai.models&&(this.settings.ai.models={...this.settings.ai.models,...e.ai.models}),e.ai.maxTokens!==void 0&&(this.settings.ai.maxTokens=e.ai.maxTokens),e.ai.temperature!==void 0&&(this.settings.ai.temperature=e.ai.temperature),e.ai.budgetLimit!==void 0&&(this.settings.ai.budgetLimit=e.ai.budgetLimit)),e.display&&(this.settings.display={...this.settings.display,...e.display}),e.assessment&&(this.settings.assessment={...this.settings.assessment,...e.assessment}),e.frontmatterKey&&(this.settings.frontmatterKey=e.frontmatterKey))}async saveSettings(){await this.saveData(this.settings),this.updateAIService()}initializeAIService(){this.aiService=z({provider:this.settings.ai.provider,apiKeys:this.settings.ai.apiKeys,models:this.settings.ai.models}),[["claude",new G],["openai",new R],["gemini",new O],["grok",new F]].forEach(([t,i])=>{var o,a;let r=this.settings.ai.apiKeys[t];r&&i.setApiKey(r);let n=(o=this.settings.ai.models[t])!=null?o:S[t].defaultModel;i.setModel(n),(a=this.aiService)==null||a.registerProvider(t,i)})}updateAIService(){J({provider:this.settings.ai.provider,apiKeys:this.settings.ai.apiKeys,models:this.settings.ai.models});let e=W();e&&["claude","openai","gemini","grok"].forEach(t=>{var n;let r=e.providers.get(t);if(r){let o=this.settings.ai.apiKeys[t];o&&r.setApiKey(o);let a=(n=this.settings.ai.models[t])!=null?n:S[t].defaultModel;r.setModel(a)}})}getCurrentProvider(){var e;return(e=this.aiService)==null?void 0:e.getCurrentProvider()}getAIService(){return this.aiService}getNoteRepository(){return this.noteRepository}async activateView(){let{workspace:e}=this.app,t=null,i=e.getLeavesOfType(j);i.length>0?t=i[0]:(t=e.getRightLeaf(!1),t&&await t.setViewState({type:j,active:!0})),t&&e.revealLeaf(t)}async assessCurrentNote(){var t;let e=this.app.workspace.getActiveFile();if(!e){new x.Notice("Please open a note.");return}if(!((t=this.aiService)!=null&&t.isAvailable())){new x.Notice("Please complete AI settings first. (Settings \u2192 Evergreen Note Cultivator)");return}try{if(!(await this.app.vault.read(e)).trim()){new x.Notice("Note content is empty.");return}new q(this.app,this,e).open()}catch(i){let r=i instanceof Error?i.message:"Unable to read note.";new x.Notice(`Error: ${r}`)}}async showGrowthGuide(){var i;let e=this.app.workspace.getActiveFile();if(!e){new x.Notice("Please open a note.");return}if(!((i=this.aiService)!=null&&i.isAvailable())){new x.Notice("Please complete AI settings first.");return}new q(this.app,this,e,"growth-guide").open()}async updateMaturity(){let e=this.app.workspace.getActiveFile();if(!e){new x.Notice("Please open a note.");return}new q(this.app,this,e,"update-maturity").open()}};
